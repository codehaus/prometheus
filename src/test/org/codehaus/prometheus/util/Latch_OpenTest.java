/*
 * Copyright (c) 2007 Peter Veentjer
 *
 * This program is made available under the terms of the MIT License.
 */
package org.codehaus.prometheus.util;

/**
 * Unittests the {@link Latch#open()} method.
 *
 * @author Peter Veentjer.
 */
public class Latch_OpenTest extends Latch_AbstractTest {

    public void testAlreadyOpen() {
        newOpenLatch();

        OpenThread openThread = scheduleOpen();
        joinAll(openThread);
        assertTrue(latch.isOpen());
    }

    public void testClosed() {
        newClosedLatch();

        AwaitThread awaitThread1 = scheduleAwait(START_UNINTERRUPTED);
        AwaitThread awaitThread2 = scheduleAwait(START_UNINTERRUPTED);
        AwaitThread awaitThread3 = scheduleAwait(START_UNINTERRUPTED);
        sleepMs(DELAY_SMALL_MS);
        awaitThread1.assertIsStarted();
        awaitThread2.assertIsStarted();
        awaitThread3.assertIsStarted();

        OpenThread openThread = scheduleOpen();
        joinAll(openThread, awaitThread1, awaitThread2, awaitThread3);
        assertTrue(latch.isOpen());
        awaitThread1.assertIsTerminated();
        awaitThread2.assertIsTerminated();
        awaitThread3.assertIsTerminated();
    }
}
