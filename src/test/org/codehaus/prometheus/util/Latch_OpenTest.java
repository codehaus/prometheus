/*
 * Copyright (c) 2007 Peter Veentjer
 *
 * This program is made available under the terms of the MIT License.
 */
package org.codehaus.prometheus.util;

/**
 * Unittests the {@link Latch#open()} method.
 *
 * @author Peter Veentjer.
 */
public class Latch_OpenTest extends Latch_AbstractTest {

    //The latch already is open
    public void testAlreadyOpen() {
        newOpenLatch();
        open();        
    }

    //the latch begins closed
    public void testBeginsClosed() {
        newClosedLatch();

        AwaitThread awaitThread1 = scheduleAwait(START_UNINTERRUPTED);
        AwaitThread awaitThread2 = scheduleAwait(START_UNINTERRUPTED);
        AwaitThread awaitThread3 = scheduleAwait(START_UNINTERRUPTED);

        //make sure that all waits are waiting
        giveOthersAChance();
        awaitThread1.assertIsStarted();
        awaitThread2.assertIsStarted();
        awaitThread3.assertIsStarted();

        //after opening the latch, all waiters should complete
        open();
        joinAll(awaitThread1, awaitThread2, awaitThread3);
        awaitThread1.assertIsTerminatedNormally();
        awaitThread2.assertIsTerminatedNormally();
        awaitThread3.assertIsTerminatedNormally();
    }   
}
